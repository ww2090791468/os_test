import{m as j,p as n,c as w}from"./index-CV5AmAh9.js";const C="./repository.json";let g=null;async function F(){if(g)return g;try{const o=await fetch(C);if(!o.ok)throw new Error(`Failed to load questions: ${o.statusText}`);const a=await o.json();if(!Array.isArray(a))throw new Error("Invalid data format: expected an array");return g=a,g}catch(o){throw console.error("Error loading questions:",o),o}}function T(o){const a=[...o];for(let s=a.length-1;s>0;s--){const r=Math.floor(Math.random()*(s+1));[a[s],a[r]]=[a[r],a[s]]}return a}function _(o,a){return o.filter(s=>a.includes(s.序号))}const p="os_quiz_data",x=j("quiz",()=>{const o=n([]),a=n([]),s=n(0),r=n({}),l=n(!1),c=n(!1),f=n("sequential"),u=n(new Set),i=n([]),d=w(()=>a.value[s.value]||null),Q=w(()=>{const e=a.value.length,t=s.value+1;return{current:t,total:e,percentage:e>0?Math.round(t/e*100):0}}),q=w(()=>{const e=Object.keys(r.value).length,t=i.value.filter(m=>m.isCorrect).length,h=e>0?Math.round(t/e*100):0;return{totalAnswered:e,correctCount:t,accuracy:h,totalMistakes:u.value.size,history:i.value}});async function y(){try{o.value=await F()}catch(e){throw console.error("Failed to load questions:",e),e}}async function A(e){switch(f.value=e,s.value=0,r.value={},l.value=!1,c.value=!1,o.value.length===0&&await y(),e){case"sequential":a.value=[...o.value];break;case"random":a.value=T(o.value);break;case"mistakes":const t=Array.from(u.value);a.value=t.length>0?_(o.value,t):[];break}v()}function S(e){const t=d.value;if(!t)return;const h=e===t.正确答案;r.value[t.序号]=e,l.value=!0,c.value=!0;const m={questionId:t.序号,question:t.题目,userAnswer:e,correctAnswer:t.正确答案,isCorrect:h,timestamp:Date.now(),mode:f.value};i.value.push(m),h||u.value.add(t.序号),v()}function M(){s.value<a.value.length-1&&(s.value++,l.value=!1,c.value=!1)}function I(){var e,t;s.value>0&&(s.value--,l.value=!!r.value[(e=d.value)==null?void 0:e.序号],c.value=!!r.value[(t=d.value)==null?void 0:t.序号])}function E(e){if(e>=0&&e<a.value.length){s.value=e;const t=a.value[e].序号;l.value=!!r.value[t],c.value=!!r.value[t]}}function O(){const e=d.value;e&&delete r.value[e.序号],l.value=!1,c.value=!1,v()}function b(){u.value.clear(),v()}function z(e){u.value.delete(e),v()}function k(){try{const e=localStorage.getItem(p);if(e){const t=JSON.parse(e);u.value=new Set(t.mistakes||[]),i.value=t.history||[],f.value=t.lastMode||"sequential"}}catch(e){console.error("Failed to load storage data:",e)}}function v(){try{const e={mistakes:Array.from(u.value),history:i.value,lastMode:f.value};localStorage.setItem(p,JSON.stringify(e))}catch(e){console.error("Failed to save storage data:",e)}}function R(){a.value=[],s.value=0,r.value={},l.value=!1,c.value=!1,u.value.clear(),i.value=[],v()}return k(),{allQuestions:o,currentQuestions:a,currentIndex:s,userAnswers:r,isAnswered:l,showResult:c,currentMode:f,mistakes:u,answerHistory:i,currentQuestion:d,progress:Q,stats:q,loadAllQuestions:y,startQuiz:A,submitAnswer:S,nextQuestion:M,prevQuestion:I,goToQuestion:E,resetCurrentQuestion:O,clearMistakes:b,removeMistake:z,loadStorageData:k,saveStorageData:v,resetAll:R}});export{x as u};
